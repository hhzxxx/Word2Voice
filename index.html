<div>
  <form id="tf" action="/yuyin/get" method="get">
    <div>
      <label>文本</label>
      <input id="text" name="text" autocomplete="off" value="测试测试测试" />
    </div>
    <div>
      <label>声音</label>
      <input id="voice" name="voice" autocomplete="off" value="Aixia" />
    </div>
    <div>
      <label>音量</label>
      <input id="volume" name="volume" autocomplete="off" value="50" />
    </div>
    <div>
      <label>语速</label>
      <input id="speech_rate" name="speech_rate" autocomplete="off" value="0" />
    </div>
    <div>
      <button type="button" id="gen">生成</button>
      <button style="margin-left: 20px" type="button" id="down">下载</button>
    </div>
  </form>
  <audio id="audio" controls="controls"></audio>
</div>

<div class="fadines" style="display: flex">
  <!--通用-->
  <div class="itemg hide">
    <ul>
      <li>
        Aiqi
        <p>艾琪，温柔女声</p>
      </li>
      <li>
        Aicheng
        <p>艾诚，标准男声</p>
      </li>
      <li>
        aijia
        <p>艾佳，标准女声</p>
      </li>
      <li>
        Siqi
        <p>思琪，温柔女声</p>
      </li>
      <li>
        Sijia
        <p>思佳，标准女声</p>
      </li>
      <li>
        Sicheng
        <p>思诚，标准男声</p>
      </li>
      <li>
        Ruoxi
        <p>若兮，温柔女声</p>
      </li>
      <li>
        Aida
        <p>艾达，标准男声</p>
      </li>
      <li>
        Ninger
        <p>宁儿，标准女声</p>
      </li>
      <li>
        Xiaoyun
        <p>小云，标准女声</p>
      </li>
      <li>
        Xiaogang
        <p>小刚，标准男声</p>
      </li>
      <li>
        Ruilin
        <p>瑞琳，标准男声</p>
      </li>
    </ul>
  </div>
  <!--客服-->
  <div class="itemg">
    <ul>
      <li class="on">
        Aixia
        <p>艾夏，亲和女声</p>
      </li>
      <li>
        Aiyue
        <p>艾悦，温柔女声</p>
      </li>
      <li>
        Aiya
        <p>艾雅，严厉女声</p>
      </li>
      <li>
        Aijing
        <p>艾婧，严厉女声</p>
      </li>
      <li>
        Aimei
        <p>艾美，甜美女声</p>
      </li>
      <li>
        Siyue
        <p>思悦，温柔女声</p>
      </li>
      <li>
        Aina
        <p>艾娜，浙普女声</p>
      </li>
      <li>
        Aishuo
        <p>艾硕，自然男声</p>
      </li>
      <li>
        Aiyu
        <p>艾雨，自然女声</p>
      </li>
      <li>
        Xiaomei
        <p>小美，甜美女声</p>
      </li>
      <li>
        Yina
        <p>伊娜，浙普女声</p>
      </li>
      <li>
        Sijing
        <p>思婧，严厉女声</p>
      </li>
    </ul>
  </div>
  <!--文学-->
  <div class="itemg hide">
    <ul>
      <li>
        Aiyuan
        <p>艾媛，知心姐姐</p>
      </li>
      <li>
        Aichu
        <p>艾厨，舌尖男声</p>
      </li>
      <li>
        Aiqian
        <p>艾倩，资讯女生</p>
      </li>
      <li>
        Ainan
        <p>艾楠，广告男声</p>
      </li>
      <li>
        Aixiao
        <p>艾笑，资讯女生</p>
      </li>
      <li>
        Aiying
        <p>艾颖，软萌童声</p>
      </li>
      <li>
        Aixiang
        <p>艾祥，磁性男声</p>
      </li>
      <li>
        Aihao
        <p>艾浩，资讯男声</p>
      </li>
      <li>
        Aimo
        <p>艾墨，情感男声</p>
      </li>

      <li>
        Aiming
        <p>艾茗，诙谐男声</p>
      </li>
      <li>
        Aiye
        <p>艾晔，青年男声</p>
      </li>
      <li>
        Aide
        <p>艾德，新闻男声</p>
      </li>
      <li>
        Aishu
        <p>艾树，资讯男声</p>
      </li>
      <li>
        Airu
        <p>艾茹，新闻女声</p>
      </li>
      <li>
        Aiting
        <p>艾婷，电台女声</p>
      </li>
      <li>
        Aifan
        <p>艾凡，情感女声</p>
      </li>
    </ul>
  </div>
  <!--童声-->
  <div class="itemg hide">
    <ul>
      <li>
        Aitong
        <p>艾彤，儿童音</p>
      </li>
      <li>
        Aiwei
        <p>艾薇，萝莉女声</p>
      </li>
      <li>
        Aibao
        <p>艾宝，萝莉女声</p>
      </li>
      <li>
        Xiaobei
        <p>小北，萝莉女声</p>
      </li>
      <li>
        Sitong
        <p>思彤，儿童音</p>
      </li>
    </ul>
  </div>
  <!--英语-->
  <div class="itemg hide">
    <ul>
      <li>
        Luca
        <p>Luca，英音男声</p>
      </li>
      <li>
        Luna
        <p>Luna，英音女声</p>
      </li>
      <li>
        Emily
        <p>Emily，英音女声</p>
      </li>
      <li>
        Eric
        <p>Eric，英音男声</p>
      </li>
      <li>
        Olivia
        <p>Olivia，英音女声</p>
      </li>
      <li>
        Andy
        <p>Andy，美音男声</p>
      </li>
      <li>
        Abby
        <p>Abby，美音女声</p>
      </li>
      <li>
        William
        <p>William，英音男声</p>
      </li>
      <li>
        Lydia
        <p>Lydia，英中双语</p>
      </li>
      <li>
        Annie
        <p>Annie，美语女声</p>
      </li>
      <li>
        Wendy
        <p>Wendy，英音女声</p>
      </li>
      <li>
        Harry
        <p>Harry，英音男声</p>
      </li>
    </ul>
  </div>
  <!--方言-->
  <div class="itemg hide">
    <ul>
      <li>
        Qingqing

        <p>青青，台湾话女声</p>
      </li>
      <li>
        Cuijie

        <p>翠姐，东北话女声</p>
      </li>
      <li>
        Xiaoze

        <p>小泽，湖南重口音</p>
      </li>
      <li>
        Shanshan

        <p>姗姗，粤语女声</p>
      </li>
      <li>
        Xiaoyue

        <p>小玥，四川话女声</p>
      </li>
    </ul>
  </div>
  <!--多语种-->
  <div class="itemg hide">
    <ul>
      <li>
        Tomoka

        <p>智香，日语女声</p>
      </li>
      <li>
        Tomoya

        <p>智也，日语男声</p>
      </li>
    </ul>
  </div>
</div>

<script>
  let blobUrl = "";

  window.onbeforeunload = function (event) {
    if (blobUrl) {
      window.URL.revokeObjectURL(blobUrl);
    }
  };

  document.getElementById("down").onclick = function () {
    if (blobUrl) {
      let a = document.createElement("a");
      let filename = "yuyin" + ".mp3";
      a.href = blobUrl;
      a.download = filename;
      a.click();
      a.remove();
    }else{
        alert("请先生成")
    }
  };

  document.getElementById("gen").onclick = function () {
    if (blobUrl) {
      console.log(blobUrl);
      window.URL.revokeObjectURL(blobUrl);
    }
    var text = document.getElementById("text").value.trim();
    var voice = document.getElementById("voice").value.trim();
    var volume = document.getElementById("volume").value.trim();
    var speech_rate = document.getElementById("speech_rate").value.trim();

    //步骤一:创建异步对象
    var ajax = new XMLHttpRequest();
    //步骤二:设置请求的url参数,参数一是请求的类型,参数二是请求的url,可以带参数,动态的传递参数starName到服务端
    ajax.open(
      "get",
      "/yuyin/get?text=" +
        text +
        "&voice=" +
        voice +
        "&volume=" +
        volume +
        "&speech_rate=" +
        speech_rate
    );
    ajax.responseType = "blob";
    //步骤三:发送请求
    ajax.send();
    //步骤四:注册事件 onreadystatechange 状态改变就会调用
    ajax.onreadystatechange = function () {
      if (ajax.readyState == 4 && ajax.status == 200) {
        blobUrl = window.URL.createObjectURL(ajax.response);
        let audio = document.getElementById("audio");
        audio.src = blobUrl;
      }
    };
  };
</script>
